# Agent Perspective Panel - System Architecture Diagram

## Complete System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                BROWSER (Client)                                     â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              App.jsx (Root)                                   â”‚ â”‚
â”‚  â”‚                                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                     StageIndicator Component                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  [Stage 1] â”â”â” [Stage 2] â”â”â” [Stage 3] â”â”â” [Stage 4]                  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                      AgentChat Component                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  User Messages  â†’  [ You: Search for Python tutorials... ]             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Agent Responses â†’  [ Agent: I'll search and save... ]                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Tool Events     â†’  [ âš¡ Executed: web_search ]                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  useAgentStream Hook â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - isStreaming                           â”‚                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - currentMessage                        â”‚                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - toolEvents                            â”‚                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - sendMessage()                         â”‚                             â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                              â”‚                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚            ğŸ†• AgentPerspectivePanel Component (NEW)                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Header: [â— Agent View] [Stage 3] [92%] [ğŸ“Œ] [â¬‡ï¸]                   â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Tabs: [ğŸ‘ï¸ See] [ğŸ› ï¸ Do] [ğŸ§  Thinking] [âš ï¸ Limits]                   â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Content Area (384px, scrollable)                                  â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                    â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ {activeTab === 'see' && <WhatISee />}                             â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ {activeTab === 'do' && <WhatICanDo />}                            â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ {activeTab === 'thinking' && <WhatImThinking />} â† CORE           â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ {activeTab === 'limits' && <MyLimitations />}                     â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                    â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  usePerspectiveStream Hook â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - contextState                          â”‚                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - availableTools                        â”‚                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - reasoningTrace â† CORE DATA            â”‚                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - limitations                           â”‚                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - confidence                            â”‚                             â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                  â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â”‚ HTTP/SSE
                                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FASTAPI BACKEND (Server)                                  â”‚
â”‚                              Port 8001                                             â”‚
â”‚                                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                           main.py (Endpoints)                                â”‚ â”‚
â”‚  â”‚                                                                              â”‚ â”‚
â”‚  â”‚  GET /                         Health check                                 â”‚ â”‚
â”‚  â”‚  GET /api/stages               Stage metadata                               â”‚ â”‚
â”‚  â”‚  GET /api/tools?stage={n}      ğŸ†• Tool schemas for stage                    â”‚ â”‚
â”‚  â”‚  POST /api/chat                Main chat endpoint (SSE streaming)           â”‚ â”‚
â”‚  â”‚                                                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        stages.py (Stage Handlers)                           â”‚ â”‚
â”‚  â”‚                                                                              â”‚ â”‚
â”‚  â”‚  Stage1BasicChat                                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ No tools                                                                â”‚ â”‚
â”‚  â”‚  â””â”€ ğŸ†• Emit: reasoning_step (basic parsing)                                 â”‚ â”‚
â”‚  â”‚                                                                              â”‚ â”‚
â”‚  â”‚  Stage2ToolRecognition                                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Tools visible (schemas passed to Claude)                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ No execution                                                            â”‚ â”‚
â”‚  â”‚  â””â”€ ğŸ†• Emit: reasoning_step, tool_evaluated                                 â”‚ â”‚
â”‚  â”‚                                                                              â”‚ â”‚
â”‚  â”‚  Stage3ToolExecution                                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ Single tool execution                                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ Up to 5 turns                                                           â”‚ â”‚
â”‚  â”‚  â””â”€ ğŸ†• Emit: reasoning_step, tool_evaluated, tool_selection, execution      â”‚ â”‚
â”‚  â”‚                                                                              â”‚ â”‚
â”‚  â”‚  Stage4MultiTool                                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ Multi-tool chaining                                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Up to 10 turns                                                          â”‚ â”‚
â”‚  â”‚  â””â”€ ğŸ†• Emit: Full reasoning trace with all events                           â”‚ â”‚
â”‚  â”‚                                                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       tools.py (Tool System)                                â”‚ â”‚
â”‚  â”‚                                                                              â”‚ â”‚
â”‚  â”‚  TOOL_SCHEMAS                                                               â”‚ â”‚
â”‚  â”‚  â”œâ”€ web_search    Schema definition                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ calculator    Schema definition                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ file_write    Schema definition                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ file_read     Schema definition                                        â”‚ â”‚
â”‚  â”‚  â””â”€ file_edit     Schema definition                                        â”‚ â”‚
â”‚  â”‚                                                                              â”‚ â”‚
â”‚  â”‚  TOOL_EXECUTORS                                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ execute_web_search()      Mock implementation                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ execute_file_write()      Write to filesystem                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ execute_file_read()       Read from filesystem                         â”‚ â”‚
â”‚  â”‚  â””â”€ execute_file_edit()       Edit existing file                           â”‚ â”‚
â”‚  â”‚                                                                              â”‚ â”‚
â”‚  â”‚  ğŸ†• TOOL_SCORING                                                            â”‚ â”‚
â”‚  â”‚  â””â”€ calculate_relevance()     Score tool match to query                    â”‚ â”‚
â”‚  â”‚                                                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ Anthropic SDK
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ANTHROPIC API (Claude)                                     â”‚
â”‚                                                                                   â”‚
â”‚  Model: claude-3-5-sonnet-20241022                                               â”‚
â”‚                                                                                   â”‚
â”‚  Streaming Mode:                                                                 â”‚
â”‚  â”œâ”€ Text content blocks                                                          â”‚
â”‚  â”œâ”€ Tool use blocks                                                              â”‚
â”‚  â””â”€ Multi-turn conversations                                                     â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Message â†’ Reasoning Trace

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USER INPUT                                                                      â”‚
â”‚    "Search for Python tutorials and save the top 3"                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. FRONTEND â†’ BACKEND                                                              â”‚
â”‚    POST /api/chat                                                                  â”‚
â”‚    {                                                                               â”‚
â”‚      messages: [{role: 'user', content: '...'}],                                  â”‚
â”‚      stage: 3,                                                                     â”‚
â”‚      config: {tools: [...], maxTurns: 5}                                          â”‚
â”‚    }                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. BACKEND PROCESSING (Stage 3 Handler)                                           â”‚
â”‚                                                                                    â”‚
â”‚    Turn 1: Initial Request                                                        â”‚
â”‚    â”œâ”€ ğŸ†• SSE: reasoning_step (parsing)                                            â”‚
â”‚    â”‚   {"type": "parsing", "timestamp": 123, "description": "...", "confidence": 0.95} â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ ğŸ†• SSE: reasoning_step (analyzing)                                          â”‚
â”‚    â”‚   {"type": "analyzing", "description": "Breaking into steps...", "confidence": 0.90} â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ ğŸ†• SSE: reasoning_step (tool_evaluation)                                    â”‚
â”‚    â”‚   {"type": "tool_evaluation", "details": {                                  â”‚
â”‚    â”‚     "tools_considered": [                                                    â”‚
â”‚    â”‚       {"name": "web_search", "score": 0.98},                                â”‚
â”‚    â”‚       {"name": "calculator", "score": 0.02}                                 â”‚
â”‚    â”‚     ]                                                                        â”‚
â”‚    â”‚   }}                                                                         â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ ğŸ†• SSE: reasoning_step (tool_selection)                                     â”‚
â”‚    â”‚   {"type": "tool_selection", "details": {                                   â”‚
â”‚    â”‚     "tool_name": "web_search",                                              â”‚
â”‚    â”‚     "reason": "User needs current info"                                     â”‚
â”‚    â”‚   }}                                                                         â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ Call Claude API with tools parameter                                       â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ Claude responds with tool_use block                                        â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ ğŸ†• SSE: reasoning_step (execution)                                          â”‚
â”‚    â”‚   {"type": "execution", "details": {"tool_name": "web_search"}}            â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ Execute tool: web_search(query='Python tutorials')                         â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ SSE: tool_result (existing event)                                          â”‚
â”‚    â”‚   {"type": "tool_result", "result": {...}}                                  â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â””â”€ Add tool result to messages                                                â”‚
â”‚                                                                                    â”‚
â”‚    Turn 2: Process Results                                                        â”‚
â”‚    â”œâ”€ ğŸ†• SSE: reasoning_step (processing)                                         â”‚
â”‚    â”‚   {"type": "processing", "description": "Filtering top 3..."}              â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ Call Claude API again (with tool result)                                   â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ Claude responds with another tool_use: file_write                          â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ ğŸ†• SSE: reasoning_step (execution)                                          â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ Execute: file_write(path='tutorials.txt', content='...')                   â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â””â”€ SSE: tool_result                                                            â”‚
â”‚                                                                                    â”‚
â”‚    Turn 3: Final Response                                                         â”‚
â”‚    â”œâ”€ ğŸ†• SSE: reasoning_step (formatting)                                         â”‚
â”‚    â”‚   {"type": "formatting", "description": "Preparing response"}              â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ Call Claude API (with both tool results)                                   â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ Claude responds with text (no tools)                                       â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ SSE: text (existing event)                                                 â”‚
â”‚    â”‚   {"type": "text", "content": "I've saved the results..."}                  â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â”œâ”€ ğŸ†• SSE: reasoning_step (complete)                                           â”‚
â”‚    â”‚   {"type": "complete", "confidence": 1.0}                                   â”‚
â”‚    â”‚                                                                               â”‚
â”‚    â””â”€ SSE: done                                                                   â”‚
â”‚                                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. FRONTEND PROCESSING                                                             â”‚
â”‚                                                                                    â”‚
â”‚    useAgentStream Hook:                                                           â”‚
â”‚    â”œâ”€ Receives SSE events                                                         â”‚
â”‚    â”œâ”€ Parses event types                                                          â”‚
â”‚    â”œâ”€ Updates currentMessage for text events                                      â”‚
â”‚    â””â”€ Updates toolEvents for tool_* events                                        â”‚
â”‚                                                                                    â”‚
â”‚    ğŸ†• usePerspectiveStream Hook:                                                  â”‚
â”‚    â”œâ”€ Listens for reasoning_step events                                          â”‚
â”‚    â”œâ”€ Builds reasoningTrace array                                                â”‚
â”‚    â”œâ”€ Calculates confidence averages                                             â”‚
â”‚    â””â”€ Triggers component re-renders                                              â”‚
â”‚                                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. UI UPDATE                                                                       â”‚
â”‚                                                                                    â”‚
â”‚    AgentChat:                                                                     â”‚
â”‚    â””â”€ Shows agent response: "I've saved the results to tutorials.txt"            â”‚
â”‚                                                                                    â”‚
â”‚    ğŸ†• AgentPerspectivePanel â†’ WhatImThinking Tab:                                 â”‚
â”‚    â””â”€ ReasoningTimeline displays:                                                â”‚
â”‚        â”œâ”€ ğŸ“ [00:00.00] Parsing (95% confidence)                                 â”‚
â”‚        â”œâ”€ ğŸ” [00:00.10] Analyzing (90% confidence)                               â”‚
â”‚        â”œâ”€ âš–ï¸ [00:00.35] Tool Evaluation                                          â”‚
â”‚        â”‚   â””â”€ web_search: 98%, calculator: 2%                                    â”‚
â”‚        â”œâ”€ âœ“ [00:00.80] Selected: web_search                                      â”‚
â”‚        â”œâ”€ âš¡ [00:00.85] Executing web_search                                      â”‚
â”‚        â”œâ”€ âš™ï¸ [00:01.23] Processing results                                       â”‚
â”‚        â”œâ”€ âœ“ [00:01.47] Selected: file_write                                      â”‚
â”‚        â”œâ”€ âš¡ [00:01.50] Executing file_write                                      â”‚
â”‚        â”œâ”€ ğŸ“‹ [00:01.70] Formatting response                                      â”‚
â”‚        â””â”€ âœ… [00:01.78] Complete                                                  â”‚
â”‚                                                                                    â”‚
â”‚        Stats: 10 steps | 3 tools | 505ms total                                   â”‚
â”‚                                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Dependency Graph

```
                    App.jsx (Root)
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
   StageIndicator   AgentChat    ğŸ†• AgentPerspectivePanel
        â”‚               â”‚               â”‚
        â”‚          useAgentStream  usePerspectiveStream
        â”‚               â”‚               â”‚
        â”‚               â”‚               â”œâ”€ WhatISee.jsx
        â”‚               â”‚               â”‚   â””â”€ (context cards)
        â”‚               â”‚               â”‚
        â”‚               â”‚               â”œâ”€ WhatICanDo.jsx
        â”‚               â”‚               â”‚   â”œâ”€ ToolCard.jsx
        â”‚               â”‚               â”‚   â””â”€ ConfidenceMeter.jsx
        â”‚               â”‚               â”‚
        â”‚               â”‚               â”œâ”€ WhatImThinking.jsx â­
        â”‚               â”‚               â”‚   â”œâ”€ ReasoningTimeline.jsx
        â”‚               â”‚               â”‚   â”‚   â””â”€ ReasoningStep.jsx
        â”‚               â”‚               â”‚   â””â”€ ConfidenceMeter.jsx
        â”‚               â”‚               â”‚
        â”‚               â”‚               â””â”€ MyLimitations.jsx
        â”‚               â”‚                   â””â”€ (limitation cards)
        â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚
                                      Shared State:
                                      - currentStage
                                      - messages
                                      - isStreaming
                                      - config
```

---

## File Structure

```
/Users/wz/Desktop/zPersonalProjects/AICraft/agent-evolution/

frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ AgentChat.jsx                      (Existing)
â”‚   â”‚   â”œâ”€â”€ StageIndicator.jsx                 (Existing)
â”‚   â”‚   â”œâ”€â”€ ExecutionVisualizer.jsx            (Existing)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ†• AgentPerspectivePanel.jsx       (NEW - Main container)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ†• perspective/                    (NEW - Directory)
â”‚   â”‚       â”œâ”€â”€ WhatISee.jsx                   (NEW)
â”‚   â”‚       â”œâ”€â”€ WhatICanDo.jsx                 (NEW)
â”‚   â”‚       â”œâ”€â”€ WhatImThinking.jsx             (NEW - CORE)
â”‚   â”‚       â”œâ”€â”€ MyLimitations.jsx              (NEW)
â”‚   â”‚       â”œâ”€â”€ ReasoningTimeline.jsx          (NEW - Visualization)
â”‚   â”‚       â””â”€â”€ ConfidenceMeter.jsx            (NEW - Reusable UI)
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAgentStream.js                  (Existing)
â”‚   â”‚   â””â”€â”€ ğŸ†• usePerspectiveStream.js         (NEW)
â”‚   â”‚
â”‚   â””â”€â”€ App.jsx                                (Modified - add panel)

backend/
â”œâ”€â”€ main.py                                    (Modified - add /api/tools)
â”œâ”€â”€ stages.py                                  (Modified - emit reasoning events)
â””â”€â”€ tools.py                                   (Modified - add relevance scoring)
```

---

## State Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GLOBAL STATE (App.jsx)                      â”‚
â”‚                                                                     â”‚
â”‚  currentStage: number          (1-4)                                â”‚
â”‚  agentConfig: object           {tools, maxTurns, systemPrompt}      â”‚
â”‚  isBuilderMode: boolean        (builder vs chat view)              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                                 â”‚
               â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AgentChat Component        â”‚    â”‚  ğŸ†• AgentPerspectivePanel     â”‚
â”‚                              â”‚    â”‚                               â”‚
â”‚  LOCAL STATE:                â”‚    â”‚  LOCAL STATE:                 â”‚
â”‚  - messages: array           â”‚â—„â”€â”€â”€â”¼â”€ activeTab: string            â”‚
â”‚  - inputValue: string        â”‚    â”‚  - isCollapsed: boolean       â”‚
â”‚  - isStreaming: boolean      â”‚â”€â”€â”€â–ºâ”‚  - isPinned: boolean          â”‚
â”‚                              â”‚    â”‚                               â”‚
â”‚  HOOK STATE:                 â”‚    â”‚  HOOK STATE:                  â”‚
â”‚  - currentMessage: string    â”‚    â”‚  - contextState: object       â”‚
â”‚  - toolEvents: array         â”‚    â”‚  - availableTools: array      â”‚
â”‚                              â”‚    â”‚  - reasoningTrace: array â­   â”‚
â”‚                              â”‚    â”‚  - limitations: array         â”‚
â”‚                              â”‚    â”‚  - confidence: number         â”‚
â”‚                              â”‚    â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                 â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    Shared via Props:
                    - currentStage
                    - messages
                    - isStreaming
                    - config
```

---

## SSE Event Types

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXISTING EVENTS                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  text                  Agent text response (streaming)               â”‚
â”‚  tool_use              Tool being invoked (Stage 2-4)                â”‚
â”‚  tool_result           Tool execution result (Stage 3-4)             â”‚
â”‚  error                 Error occurred                                â”‚
â”‚  done                  Stream complete                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ğŸ†• NEW EVENTS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  reasoning_step        Each step in reasoning process               â”‚
â”‚                        - parsing, analyzing, tool_evaluation, etc.  â”‚
â”‚                        - Includes timestamp, confidence, details    â”‚
â”‚                                                                      â”‚
â”‚  context_update        Context/memory changes                       â”‚
â”‚                        - New items in memory                        â”‚
â”‚                        - System prompt updates                      â”‚
â”‚                                                                      â”‚
â”‚  tool_evaluated        Tool relevance scoring                       â”‚
â”‚                        - Tool name, score, reasoning                â”‚
â”‚                                                                      â”‚
â”‚  confidence_score      Overall confidence update                    â”‚
â”‚                        - Aggregate score across all decisions       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Responsive Breakpoints

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DESKTOP (1440px+)                           â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      Full Chat Interface                    â”‚  â”‚
â”‚  â”‚                         (600px height)                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Agent Panel: [See] [Do] [Thinking] [Limits]  [92%] ğŸ“Œ â¬‡ï¸    â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚
â”‚  â”‚                   Full 4-tab Layout                         â”‚  â”‚
â”‚  â”‚                   (432px height)                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TABLET (768px - 1439px)                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  Chat Interface                           â”‚    â”‚
â”‚  â”‚                  (500px height)                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Panel: [See][Do][Think][Limits] [92%]  ğŸ“Œ â¬‡ï¸             â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚    â”‚
â”‚  â”‚           Compact 4-tab (380px height)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        MOBILE (< 768px)               â”‚
â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        Chat (400px)             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Panel: 92% ğŸ“Œâ¬‡ï¸                 â”‚ â”‚
â”‚  â”‚ [See][Do][Think][Lim] â† Scroll â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚   Simplified (300px)            â”‚ â”‚
â”‚  â”‚   Swipe to change tabs          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Performance Optimization Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      OPTIMIZATION LAYERS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: Component Level
â”œâ”€ React.memo() on all tab components
â”œâ”€ useMemo() for expensive calculations
â”œâ”€ useCallback() for event handlers
â””â”€ Custom shouldComponentUpdate logic

Layer 2: Rendering
â”œâ”€ Virtualization for long traces (react-window)
â”œâ”€ Incremental rendering (20 steps at a time)
â”œâ”€ Debounced state updates (50ms)
â””â”€ Lazy loading of tab content

Layer 3: Data
â”œâ”€ Delta updates (not full state)
â”œâ”€ Compression for large payloads
â”œâ”€ Batched SSE events (> 5 rapid events)
â””â”€ Local caching of tool schemas

Layer 4: Network
â”œâ”€ SSE connection reuse
â”œâ”€ Gzip compression on responses
â”œâ”€ HTTP/2 multiplexing
â””â”€ CDN for static assets

Layer 5: Bundle
â”œâ”€ Code splitting (perspective chunk)
â”œâ”€ Tree shaking (lodash-es, etc.)
â”œâ”€ Minification + uglification
â””â”€ Dynamic imports for heavy libs

Result: < 200ms initial load, < 50ms tab switch, 60fps animations
```

---

## Integration Checklist

```
Frontend Changes:
  âœ“ Create 7 new components in src/components/perspective/
  âœ“ Create usePerspectiveStream.js hook
  âœ“ Modify App.jsx (add panel, ~5 lines)
  âœ“ Modify AgentChat.jsx (pass messages to panel, ~2 lines)
  âœ“ Extend useAgentStream.js (parse new events, ~20 lines)

Backend Changes:
  âœ“ Add GET /api/tools endpoint (main.py, ~30 lines)
  âœ“ Emit reasoning events in stages.py (~40 lines)
  âœ“ Add tool relevance scoring (tools.py, ~30 lines)

Testing:
  âœ“ Unit tests for each component
  âœ“ Integration test for SSE flow
  âœ“ Accessibility audit (axe-core)
  âœ“ Performance profiling (Lighthouse)
  âœ“ Visual regression tests

Documentation:
  âœ“ Update README with panel features
  âœ“ Add inline code comments
  âœ“ Create API documentation
  âœ“ Write user guide

Deployment:
  âœ“ Feature flag for gradual rollout
  âœ“ Analytics tracking setup
  âœ“ Error monitoring (Sentry)
  âœ“ Performance monitoring
```

---

This architecture diagram provides a complete visual overview of how all components, data flows, and integrations work together to create the Agent Perspective Panel system.
